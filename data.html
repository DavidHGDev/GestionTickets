<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Historial de Tickets</title>
    <style>
        :root {
            --primary: #3b82f6;
            --excel-color: #10b981;
            --json-color: #f59e0b;
            --bg-color: #f1f5f9;
            --text-main: #1e293b;
        }
        * { box-sizing: border-box; font-family: 'Segoe UI', system-ui, sans-serif; }
        
        body { background: var(--bg-color); padding: 20px; color: var(--text-main); }

        .container { max-width: 1300px; margin: 0 auto; }

        /* HEADER */
        .header-bar {
            display: flex; justify-content: space-between; align-items: center;
            background: white; padding: 15px 25px; border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); margin-bottom: 20px;
            flex-wrap: wrap; gap: 10px;
        }
        h1 { margin: 0; font-size: 1.5rem; color: #1e3a8a; }
        .search-box {
            padding: 10px 15px; border: 1px solid #cbd5e1; border-radius: 6px; width: 300px;
        }
        .btn-group { display: flex; gap: 10px; }

        /* TABLA */
        .table-container {
            background: white; border-radius: 12px; overflow: hidden;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); overflow-x: auto;
        }
        table { width: 100%; border-collapse: collapse; min-width: 900px; }
        th { background: #f8fafc; color: #64748b; font-weight: 600; text-align: left; padding: 15px; font-size: 0.9rem; white-space: nowrap; }
        td { padding: 12px 15px; border-bottom: 1px solid #e2e8f0; font-size: 0.9rem; vertical-align: middle; }
        tr:hover { background: #f0f9ff; }
        
        th:first-child, td:first-child { width: 100px; text-align: center; background: #fff; }
        tr:hover td:first-child { background: #f0f9ff; }

        .col-obs { max-width: 300px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: #64748b; font-style: italic; }

        .btn-action {
            border: none; background: transparent; cursor: pointer; font-size: 1.2rem; padding: 5px; transition: 0.2s;
        }
        .btn-edit:hover { filter: drop-shadow(0 0 2px var(--primary)); transform: scale(1.1); }
        .btn-del:hover { filter: drop-shadow(0 0 2px #ef4444); transform: scale(1.1); }

        .btn { padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: 600; border: none; color: white; display: flex; align-items: center; gap: 5px; }
        .btn-excel { background: var(--excel-color); }
        .btn-json { background: var(--json-color); }
        .btn-save { background: var(--primary); }
        .btn-cancel { background: #e2e8f0; color: #64748b; }

        /* MODAL */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); display: none; justify-content: center; align-items: center;
            backdrop-filter: blur(4px); z-index: 1000;
        }
        .modal-overlay.active { display: flex; }
        
        .modal-content {
            background: white; width: 90%; max-width: 900px; max-height: 90vh;
            border-radius: 12px; overflow-y: auto; padding: 25px;
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.2);
        }
        
        .modal-header { display: flex; justify-content: space-between; margin-bottom: 20px; border-bottom: 1px solid #e2e8f0; padding-bottom: 10px; }
        .modal-title { font-size: 1.2rem; font-weight: bold; color: #1e3a8a; }

        .form-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; }
        .form-group { margin-bottom: 5px; }
        .form-group label { display: block; font-size: 0.75rem; color: #64748b; margin-bottom: 4px; font-weight: 600; }
        
        /* INPUTS & TEXTAREA ADAPTATIVO */
        .form-group input, .form-group textarea {
            width: 100%; padding: 8px; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 0.9rem;
        }
        /* ESTILO CLAVE PARA EL TEXTAREA AUTO-EXPANDIBLE */
        .form-group textarea {
            resize: vertical; 
            min-height: 80px; 
            overflow-y: hidden; /* Oculta scrollbar interno para que se vea limpio */
            line-height: 1.4;
        }

        .full-width { grid-column: 1 / -1; }
        .section-title { grid-column: 1 / -1; margin-top: 10px; font-size: 0.9rem; color: var(--primary); border-bottom: 1px solid #e2e8f0; padding-bottom: 5px; }

        .time-box {
            background: #ecfdf5; border: 1px solid #6ee7b7; padding: 10px; border-radius: 6px;
            grid-column: span 1; display: flex; flex-direction: column; justify-content: center;
        }
        .modal-footer { margin-top: 20px; display: flex; justify-content: flex-end; gap: 10px; border-top: 1px solid #e2e8f0; padding-top: 15px; }
    </style>
</head>
<body>

<div class="container">
    <div class="header-bar">
        <h1>üìä Base de Datos</h1>
        <input type="text" id="buscador" class="search-box" placeholder="üîç Buscar ID, Cliente, Documento...">
        <div class="btn-group">
            <button class="btn btn-excel" onclick="exportarExcel()">üìä Excel</button>
            <button class="btn btn-json" onclick="exportarJson()">üì¶ JSON</button>
        </div>
    </div>

    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>Acciones</th> <th>Fecha</th>
                    <th>ID Llamada</th>
                    <th>Cliente</th>
                    <th>Documento</th>
                    <th>Tel√©fono</th>
                    <th>Tecnolog√≠a</th>
                    <th>Observaciones</th>
                </tr>
            </thead>
            <tbody id="tabla_body"></tbody>
        </table>
    </div>
</div>

<div id="modal_edit" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header">
            <span class="modal-title">‚úèÔ∏è Modificar Registro Completo</span>
            <button class="btn-action" onclick="cerrarModal()">‚úï</button>
        </div>
        
        <input type="hidden" id="edit_id_unico">

        <div class="form-grid">
            <div class="section-title">Informaci√≥n del Cliente</div>
            <div class="form-group"><label>ID Llamada</label><input type="text" id="edit_id"></div>
            <div class="form-group"><label>Cliente</label><input type="text" id="edit_cliente"></div>
            <div class="form-group"><label>Fecha/Hora (Solo Lectura)</label><input type="text" id="edit_fecha_hora" disabled style="background:#f1f5f9;"></div>
            
            <div class="form-group"><label>Documento</label><input type="text" id="edit_cedula"></div>
            <div class="form-group"><label>Celular</label><input type="text" id="edit_celular"></div>
            
            <div class="section-title">Datos de Red (SMNET)</div>
            <div class="form-group"><label>SMNET Integrada (Prueba)</label><input type="text" id="edit_smnet_int"></div>
            <div class="form-group"><label>SMNET Unitaria</label><input type="text" id="edit_smnet_unit"></div>
            
            <div class="section-title">Detalles T√©cnicos</div>
            <div class="form-group"><label>Tecnolog√≠a</label><input type="text" id="edit_tec"></div>
            <div class="form-group"><label>Producto</label><input type="text" id="edit_prod"></div>
            <div class="form-group"><label>Dolor Puntual (Falla)</label><input type="text" id="edit_falla"></div>

            <div class="form-group full-width"><label>Datos TV (Seriales/MACs)</label><input type="text" id="edit_tv_data"></div>

            <div class="section-title">M√©tricas y Gesti√≥n</div>
            <div class="time-box">
                <label style="color:#047857;">‚è±Ô∏è Duraci√≥n (Minutos)</label>
                <input type="number" id="edit_duracion_min" step="0.1" style="border-color:#34d399; font-weight:bold;">
                <small style="color:#059669; font-size:0.7rem;">Guarda en segundos autom.</small>
            </div>
            
            <div class="form-group" style="display:flex; flex-direction:column; justify-content:center; gap:5px;">
                <label style="cursor:pointer; display:flex; gap:5px;"><input type="checkbox" id="edit_notif"> üì© Notif. Confirmada</label>
                <label style="cursor:pointer; display:flex; gap:5px;"><input type="checkbox" id="edit_venta"> üí∞ Venta Ofrecida</label>
            </div>

            <div class="section-title">Observaciones</div>
            <div class="form-group full-width">
                <textarea id="edit_obs" oninput="this.style.height = ''; this.style.height = this.scrollHeight + 'px'"></textarea>
            </div>
        </div>

        <div class="modal-footer">
            <button class="btn btn-cancel" onclick="cerrarModal()">Cancelar</button>
            <button class="btn btn-save" onclick="guardarEdicion()">üíæ Guardar Cambios</button>
        </div>
    </div>
</div>

<script src="js/db.js"></script>
<script src="js/data.js"></script>

<script>
    // Sobreescribimos la funci√≥n original de abrirModal para a√±adir el ajuste de altura
    // Esto es un "parche" para no tocar data.js, pero lo ideal es que est√© en data.js
    // Sin embargo, como data.js carga despu√©s, podemos usar un MutationObserver o evento.
    
    // Mejor opci√≥n: Evento delegado en data.js, pero para no tocarlo, usaremos el onfocus
    const tx = document.getElementById('edit_obs');
    const observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
            if (mutation.type === "attributes" && mutation.attributeName === "class") {
                if(document.getElementById('modal_edit').classList.contains('active')){
                    setTimeout(() => {
                        tx.style.height = 'auto'; 
                        tx.style.height = (tx.scrollHeight + 5) + 'px';
                    }, 50);
                }
            }
        });
    });
    observer.observe(document.getElementById('modal_edit'), { attributes: true });
</script>

</body>
</html>